<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guest Satisfaction Survey</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px 20px;
        }
        .container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 580px;
            width: 100%;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
        }
        .header h1 { font-size: 26px; margin-bottom: 6px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .lang-bar {
            position: absolute;
            top: 12px; right: 12px;
            display: flex; gap: 4px;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 200px;
        }
        .lang-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            padding: 3px 7px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .lang-btn:hover { background: rgba(255,255,255,0.3); }
        .lang-btn.active { background: white; color: #667eea; font-weight: 600; }
        .content { padding: 28px 26px; }
        .input-field {
            width: 100%;
            padding: 13px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.3s;
            background: white;
        }
        .input-field:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.15); }
        .input-field::placeholder { color: #999; }
        .question { margin-bottom: 24px; }
        .question-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .question-icon { font-size: 22px; }
        .star-rating { display: flex; gap: 6px; justify-content: center; }
        .star {
            font-size: 38px;
            cursor: pointer;
            transition: all 0.2s;
            color: #ddd;
            filter: grayscale(100%);
            user-select: none;
        }
        .star:hover { transform: scale(1.15); filter: grayscale(0%); }
        .star.active { filter: grayscale(0%); transform: scale(1.05); }
        .comment-box {
            width: 100%;
            min-height: 90px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .comment-box:focus { outline: none; border-color: #667eea; }
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.4); }
        .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .error-message {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #dc2626;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 18px;
            display: none;
            font-size: 14px;
        }
        .error-message.show { display: block; }
        .success-message { display: none; text-align: center; padding: 50px 20px; }
        .success-message.show { display: block; }
        .success-message .success-icon { font-size: 70px; margin-bottom: 16px; }
        .success-message h2 { color: #10b981; font-size: 24px; margin-bottom: 12px; }
        .success-message p { color: #666; font-size: 15px; line-height: 1.6; }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.show { display: block; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 36px; height: 36px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 560px) {
            .star { font-size: 32px; }
            .content { padding: 22px 18px; }
            .header { padding: 40px 20px 24px; }
            .lang-bar { top: 8px; right: 8px; max-width: 170px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="lang-bar" id="langBar"></div>
        <h1 id="titleText"></h1>
        <p id="subtitleText"></p>
    </div>
    <div class="content">
        <div id="surveyForm">
            <div class="error-message" id="errorMessage"></div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">ğŸšª</span>
                    <span id="labelRoom"></span>
                </div>
                <input type="text" id="roomNumber" class="input-field" placeholder="101">
            </div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">ğŸ“§</span>
                    <span id="labelEmail"></span>
                </div>
                <input type="email" id="emailAddress" class="input-field" placeholder="ornek@email.com">
            </div>
            <div id="deptQuestions"></div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">ğŸ“</span>
                    <span id="labelComments"></span>
                </div>
                <textarea class="comment-box" id="comments" placeholder="..."></textarea>
            </div>
            <div class="loading" id="loading"><div class="spinner"></div></div>
            <button class="submit-btn" id="submitBtn" onclick="submitSurvey()"></button>
        </div>
        <div class="success-message" id="successMessage">
            <div class="success-icon">âœ…</div>
            <h2 id="successTitle"></h2>
            <p id="successBody"></p>
            <p style="margin-top:14px; font-weight:600;" id="successFooter"></p>
        </div>
    </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

const supabase = createClient(
    'https://hxjpzgqrylmcwabkfnqc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4anB6Z3FyeWxtY3dhYmtmbnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1Nzk1ODksImV4cCI6MjA4NTE1NTU4OX0.YwQUuliCuxl4yc_Wqbt7UA79QYD1wxl-bmK4h1xG6Rc'
);

// â”€â”€â”€ GLOBAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let QUESTIONS_DB = [];
let currentLang = 'tr';
const ratings = {};

// â”€â”€â”€ LOAD QUESTIONS FROM DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadQuestions() {
    try {
        const { data, error } = await supabase
            .from('survey_questions')
            .select('*')
            .eq('is_active', true)
            .order('sort_order', { ascending: true });
        
        if (error) throw error;
        
        QUESTIONS_DB = data || [];
        console.log('âœ… Sorular yÃ¼klendi:', QUESTIONS_DB.length);
    } catch (e) {
        console.error('âŒ Soru yÃ¼kleme hatasÄ±:', e);
        // Fallback: boÅŸ bÄ±rak (kullanÄ±cÄ±ya mesaj gÃ¶ster)
        QUESTIONS_DB = [];
    }
}

// â”€â”€â”€ LANGUAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS = {
    tr: {
        code:'tr', name:'TR',
        title:'ğŸ¨ Misafir Memnuniyet Anketi',
        subtitle:'GÃ¶rÃ¼ÅŸleriniz bizim iÃ§in Ã§ok deÄŸerli!',
        labelRoom:'Oda NumaranÄ±z', labelEmail:'E-posta Adresiniz',
        labelComments:'Ã–nerileriniz ve YorumlarÄ±nÄ±z',
        btnSubmit:'Anketi GÃ¶nder',
        successTitle:'TeÅŸekkÃ¼r Ederiz!',
        successBody:'GÃ¶rÃ¼ÅŸleriniz bizim iÃ§in Ã§ok deÄŸerli. Daha iyi bir hizmet sunabilmek iÃ§in geri bildirimlerinizi dikkate alacaÄŸÄ±z.',
        successFooter:'Keyifli konaklama dileriz! ğŸ¨',
        errRoom:'LÃ¼tfen oda numaranÄ±zÄ± girin!',
        errEmail:'LÃ¼tfen e-posta adresinizi girin!',
        errEmailFmt:'LÃ¼tfen geÃ§erli bir e-posta adresi girin!',
        errRating:'LÃ¼tfen en az bir departmana puan verin!',
        errSend:'Anket gÃ¶nderilemedi. LÃ¼tfen tekrar deneyin.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_tr}))
    },
    en: {
        code:'en', name:'EN',
        title:'ğŸ¨ Guest Satisfaction Survey',
        subtitle:'Your feedback is very important to us!',
        labelRoom:'Room Number', labelEmail:'Your Email Address',
        labelComments:'Suggestions & Comments',
        btnSubmit:'Submit Survey',
        successTitle:'Thank You!',
        successBody:'Your feedback is very valuable to us. We will take your comments into account to provide better service.',
        successFooter:'Enjoy your stay! ğŸ¨',
        errRoom:'Please enter your room number!',
        errEmail:'Please enter your email address!',
        errEmailFmt:'Please enter a valid email address!',
        errRating:'Please rate at least one department!',
        errSend:'Survey could not be sent. Please try again.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_en}))
    },
    ru: {
        code:'ru', name:'RU',
        title:'ğŸ¨ ĞĞ¿Ñ€Ğ¾Ñ ÑƒĞ´Ğ¾Ğ²Ğ»ĞµÑ‚Ğ²Ğ¾Ñ€Ñ‘Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ³Ğ¾ÑÑ‚ĞµĞ¹',
        subtitle:'Ğ’Ğ°ÑˆĞ¸ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ñ!',
        labelRoom:'ĞĞ¾Ğ¼ĞµÑ€ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹', labelEmail:'Ğ’Ğ°Ñˆ Ğ°Ğ´Ñ€ĞµÑ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‡Ñ‚Ñ‹',
        labelComments:'ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸',
        btnSubmit:'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ñ€Ğ¾Ñ',
        successTitle:'Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾!',
        successBody:'Ğ’Ğ°ÑˆĞ¸ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹ Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ†ĞµĞ½Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ñ. ĞœÑ‹ ÑƒÑ‡Ñ‚Ñ‘Ğ¼ Ğ²Ğ°ÑˆĞ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ.',
        successFooter:'ĞŸÑ€Ğ¸ÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€ĞµĞ±Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ! ğŸ¨',
        errRoom:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ²Ğ°ÑˆĞµĞ¹ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹!',
        errEmail:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‡Ñ‚Ñ‹!',
        errEmailFmt:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ!',
        errRating:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ñ†ĞµĞ½ÑŒÑ‚Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ¸Ğ½ Ğ¾Ñ‚Ğ´ĞµĞ»!',
        errSend:'ĞĞ¿Ñ€Ğ¾Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_ru}))
    },
    de: {
        code:'de', name:'DE',
        title:'ğŸ¨ GÃ¤ste-Zufriedenheitsbefragung',
        subtitle:'Ihre RÃ¼ckmeldung ist sehr wichtig fÃ¼r uns!',
        labelRoom:'Zimmernummer', labelEmail:'Ihre E-Mail-Adresse',
        labelComments:'VorschlÃ¤ge und Kommentare',
        btnSubmit:'Umfrage senden',
        successTitle:'Vielen Dank!',
        successBody:'Ihre RÃ¼ckmeldung ist sehr wertvoll. Wir werden Ihre Kommentare berÃ¼cksichtigen.',
        successFooter:'GenieÃŸen Sie Ihren Aufenthalt! ğŸ¨',
        errRoom:'Bitte geben Sie Ihre Zimmernummer ein!',
        errEmail:'Bitte geben Sie Ihre E-Mail-Adresse ein!',
        errEmailFmt:'Bitte geben Sie eine gÃ¼ltige E-Mail ein!',
        errRating:'Bitte bewerten Sie mindestens eine Abteilung!',
        errSend:'Die Umfrage konnte nicht gesendet werden.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_de}))
    },
    pl: {
        code:'pl', name:'PL',
        title:'ğŸ¨ Ankieta satysfakcji goÅ›ci',
        subtitle:'Wasze opinie sÄ… dla nas bardzo waÅ¼ne!',
        labelRoom:'Numer pokoju', labelEmail:'TwÃ³j adres e-mail',
        labelComments:'Sugestie i komentarze',
        btnSubmit:'WyÅ›lij ankietÄ™',
        successTitle:'DziÄ™kujemy!',
        successBody:'Wasze opinie sÄ… bardzo cenne. UwzglÄ™dnimy wasze komentarze.',
        successFooter:'MiÅ‚o spÄ™dziÄ‡ czas! ğŸ¨',
        errRoom:'ProszÄ™ podaÄ‡ numer pokoju!',
        errEmail:'ProszÄ™ podaÄ‡ adres e-mail!',
        errEmailFmt:'ProszÄ™ podaÄ‡ poprawny adres e-mail!',
        errRating:'ProszÄ™ oceniÄ‡ przynajmniej jeden dziaÅ‚!',
        errSend:'Ankieta nie zostaÅ‚a wysÅ‚ana. SprÃ³buj ponownie.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_pl}))
    },
    cs: {
        code:'cs', name:'CZ',
        title:'ğŸ¨ PrÅ¯zkum spokojnosti hostÃ©',
        subtitle:'VaÅ¡e zpÄ›tnÃ¡ vazba je pro nÃ¡s hodnÄ› dÅ¯leÅ¾itÃ¡!',
        labelRoom:'ÄŒÃ­slo mÃ­stnosti', labelEmail:'VÃ¡Å¡ e-mailovÃ½ adresa',
        labelComments:'NÃ¡vrhy a komentÃ¡Å™e',
        btnSubmit:'Odeslat prÅ¯zkum',
        successTitle:'DÄ›kujeme!',
        successBody:'VaÅ¡e zpÄ›tnÃ¡ vazba je pro nÃ¡s hodnÄ› cennÃ¡.',
        successFooter:'PÅ™Ã­jemnÃ½ pobyt! ğŸ¨',
        errRoom:'ProsÃ­m, zadejte ÄÃ­slo mÃ­stnosti!',
        errEmail:'ProsÃ­m, zadejte e-mailovou adresu!',
        errEmailFmt:'ProsÃ­m, zadejte platnou e-mailovou adresu!',
        errRating:'ProsÃ­m, ohodnoÅ¥te alespoÅˆ jednu oddÄ›lenÃ­!',
        errSend:'PrÅ¯zkum nebyl odeslÃ¡n. Zkuste znovu.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_cs}))
    },
    fr: {
        code:'fr', name:'FR',
        title:'ğŸ¨ EnquÃªte de satisfaction des hÃ´tes',
        subtitle:'Vos avis sont trÃ¨s importants pour nous !',
        labelRoom:'NumÃ©ro de chambre', labelEmail:'Votre adresse e-mail',
        labelComments:'Suggestions et commentaires',
        btnSubmit:'Envoyer l\'enquÃªte',
        successTitle:'Merci !',
        successBody:'Vos avis sont trÃ¨s prÃ©cieux pour nous.',
        successFooter:'Profitez de votre sÃ©jour ! ğŸ¨',
        errRoom:'Veuillez entrer votre numÃ©ro de chambre !',
        errEmail:'Veuillez entrer votre adresse e-mail !',
        errEmailFmt:'Veuillez entrer une adresse e-mail valide !',
        errRating:'Veuillez Ã©valuer au moins un dÃ©partement !',
        errSend:'L\'enquÃªte n\'a pas pu Ãªtre envoyÃ©e.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_fr}))
    },
    da: {
        code:'da', name:'DK',
        title:'ğŸ¨ GÃ¦stetilfreds UndersÃ¸gelse',
        subtitle:'Jeres tilbagemeldinger er meget vigtige for os!',
        labelRoom:'Rumsnummer', labelEmail:'Din e-mailadresse',
        labelComments:'Forslag og kommentarer',
        btnSubmit:'IndsÃ¦nd undersÃ¸gelse',
        successTitle:'Tak!',
        successBody:'Jeres tilbagemeldinger er meget forskellige for os.',
        successFooter:'Nyd dit ophold! ğŸ¨',
        errRoom:'Venlig udfyld dit rumsnummer!',
        errEmail:'Venlig udfyld din e-mailadresse!',
        errEmailFmt:'Venlig udfyld en gyldig e-mailadresse!',
        errRating:'Venlig vurderer mindst Ã©n afdeling!',
        errSend:'UndersÃ¸gelsen kunne ikke sendes.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_da}))
    },
    ro: {
        code:'ro', name:'RO',
        title:'ğŸ¨ Sondaj de satisfacÈ›ie',
        subtitle:'Opiniile dumneavoastrÄƒ sunt foart importante!',
        labelRoom:'NumÄƒrul camerelor', labelEmail:'Adresa de e-mail',
        labelComments:'Sugestii È™i comentarii',
        btnSubmit:'TrimiteÈ›i sondajul',
        successTitle:'MulÈ›umim!',
        successBody:'Opiniile dumneavoastrÄƒ sunt foart preÈ›ioase.',
        successFooter:'BucuraÈ›i-vÄƒ de È™ederea dumneavoastrÄƒ! ğŸ¨',
        errRoom:'VÄƒ rugÄƒm sÄƒ introduceÈ›i numÄƒrul camerelor!',
        errEmail:'VÄƒ rugÄƒm sÄƒ introduceÈ›i adresa de e-mail!',
        errEmailFmt:'VÄƒ rugÄƒm sÄƒ introduceÈ›i o adresÄƒ validÄƒ!',
        errRating:'VÄƒ rugÄƒm sÄƒ evaluaÈ›i cel puÈ›in un departament!',
        errSend:'Sondajul nu a fost trimis. ÃncercaÈ›i din nou.',
        getDepts: () => QUESTIONS_DB.map(q => ({key: q.key, icon: q.icon, name: q.name_ro}))
    }
};

// â”€â”€â”€ DETECT LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function detectLang() {
    const url = new URLSearchParams(window.location.search);
    if (url.get('lang') && LANGS[url.get('lang')]) return url.get('lang');
    const b = (navigator.language || 'tr').split('-')[0].toLowerCase();
    return LANGS[b] ? b : 'tr';
}

// â”€â”€â”€ RENDER LANG BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLangBar() {
    document.getElementById('langBar').innerHTML = Object.keys(LANGS).map(c =>
        `<button class="lang-btn ${c===currentLang?'active':''}" onclick="setLang('${c}')">${LANGS[c].name}</button>`
    ).join('');
}

// â”€â”€â”€ SET LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLang(code) {
    currentLang = code;
    const L = LANGS[code];
    document.documentElement.lang = code;
    document.getElementById('titleText').textContent     = L.title;
    document.getElementById('subtitleText').textContent  = L.subtitle;
    document.getElementById('labelRoom').textContent     = L.labelRoom;
    document.getElementById('labelEmail').textContent    = L.labelEmail;
    document.getElementById('labelComments').textContent = L.labelComments;
    document.getElementById('submitBtn').textContent     = L.btnSubmit;
    document.getElementById('successTitle').textContent  = L.successTitle;
    document.getElementById('successBody').textContent   = L.successBody;
    document.getElementById('successFooter').textContent = L.successFooter;
    renderLangBar();
    renderDeptQuestions();
}
window.setLang = setLang;

// â”€â”€â”€ RENDER DEPT QUESTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDeptQuestions() {
    const L = LANGS[currentLang];
    const depts = L.getDepts(); // DB'den al
    const c = document.getElementById('deptQuestions');
    
    if (!depts.length) {
        c.innerHTML = '<p style="text-align:center;color:#999;padding:30px">Sorular yÃ¼kleniyor...</p>';
        return;
    }
    
    c.innerHTML = depts.map(d => {
        ratings[d.key] = ratings[d.key] || 0;
        const v = ratings[d.key];
        return `<div class="question">
            <div class="question-title"><span class="question-icon">${d.icon}</span><span>${d.name}</span></div>
            <div class="star-rating" data-dept="${d.key}">
                ${[1,2,3,4,5].map(i=>`<span class="star ${i<=v?'active':''}" data-value="${i}">${i<=v?'â­':'â˜†'}</span>`).join('')}
            </div></div>`;
    }).join('');

    c.querySelectorAll('.star-rating').forEach(g => {
        const dept = g.dataset.dept;
        g.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', () => {
                const val = parseInt(star.dataset.value);
                ratings[dept] = val;
                g.querySelectorAll('.star').forEach((s,i) => {
                    s.classList.toggle('active', i < val);
                    s.textContent = i < val ? 'â­' : 'â˜†';
                });
            });
        });
    });
}

// â”€â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.submitSurvey = async function() {
    const L = LANGS[currentLang];
    const room  = document.getElementById('roomNumber').value.trim();
    const email = document.getElementById('emailAddress').value.trim();

    if (!room)  return showError(L.errRoom);
    if (!email) return showError(L.errEmail);
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return showError(L.errEmailFmt);
    if (!Object.values(ratings).some(r => r > 0))   return showError(L.errRating);

    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    document.getElementById('loading').classList.add('show');
    hideError();

    try {
        // Ratings JSON formatÄ±nda
        const ratingsObj = {};
        QUESTIONS_DB.forEach(q => {
            if (ratings[q.key] && ratings[q.key] > 0) {
                ratingsObj[q.key] = ratings[q.key];
            }
        });

        const payload = {
            room_number: room,
            email: email,
            comments: document.getElementById('comments').value || null,
            ratings: ratingsObj
        };

        const { error } = await supabase.from('surveys').insert([payload]);
        if (error) throw error;

        document.getElementById('surveyForm').style.display = 'none';
        document.getElementById('successMessage').classList.add('show');
    } catch(e) {
        console.error(e);
        showError(L.errSend);
        btn.disabled = false;
    } finally {
        document.getElementById('loading').classList.remove('show');
    }
}

function showError(msg) {
    const el = document.getElementById('errorMessage');
    el.textContent = 'âš ï¸ ' + msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 5000);
}
function hideError() { document.getElementById('errorMessage').classList.remove('show'); }

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async function init() {
    // Ã–NCE SORULARI YÃœKLe
    await loadQuestions();
    
    // URL'den oda
    const url = new URLSearchParams(window.location.search);
    const room = decodeURIComponent(url.get('oda') || '');
    if (room) document.getElementById('roomNumber').value = room;
    
    // Dil
    currentLang = detectLang();
    setLang(currentLang);
})();
</script>
</body>
</html>
