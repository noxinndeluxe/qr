<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guest Satisfaction Survey</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px 20px;
        }
        .container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 580px;
            width: 100%;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
        }
        .header h1 { font-size: 26px; margin-bottom: 6px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .lang-bar {
            position: absolute;
            top: 12px; right: 12px;
            display: flex; gap: 4px;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 200px;
        }
        .lang-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            padding: 3px 7px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .lang-btn:hover { background: rgba(255,255,255,0.3); }
        .lang-btn.active { background: white; color: #667eea; font-weight: 600; }
        .content { padding: 28px 26px; }
        .input-field {
            width: 100%;
            padding: 13px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.3s;
            background: white;
        }
        .input-field:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.15); }
        .input-field::placeholder { color: #999; }
        .question { margin-bottom: 24px; }
        .question-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .question-icon { font-size: 22px; }
        .star-rating { display: flex; gap: 6px; justify-content: center; }
        .star {
            font-size: 38px;
            cursor: pointer;
            transition: all 0.2s;
            color: #ddd;
            filter: grayscale(100%);
            user-select: none;
            -webkit-user-select: none;
        }
        .star:hover { transform: scale(1.15); filter: grayscale(0%); }
        .star.active { filter: grayscale(0%); transform: scale(1.05); }
        .comment-box {
            width: 100%;
            min-height: 90px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .comment-box:focus { outline: none; border-color: #667eea; }
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.4); }
        .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .error-message {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #dc2626;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 18px;
            display: none;
            font-size: 14px;
        }
        .error-message.show { display: block; }
        .success-message { display: none; text-align: center; padding: 50px 20px; }
        .success-message.show { display: block; }
        .success-message .success-icon { font-size: 70px; margin-bottom: 16px; }
        .success-message h2 { color: #10b981; font-size: 24px; margin-bottom: 12px; }
        .success-message p { color: #666; font-size: 15px; line-height: 1.6; }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.show { display: block; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 36px; height: 36px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 560px) {
            .star { font-size: 32px; }
            .content { padding: 22px 18px; }
            .header { padding: 40px 20px 24px; }
            .lang-bar { top: 8px; right: 8px; max-width: 170px; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="lang-bar" id="langBar"></div>
        <h1 id="titleText"></h1>
        <p id="subtitleText"></p>
    </div>
    <div class="content">
        <div id="surveyForm">
            <div class="error-message" id="errorMessage"></div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">üö™</span>
                    <span id="labelRoom"></span>
                </div>
                <input type="text" id="roomNumber" class="input-field" placeholder="101">
            </div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">üìß</span>
                    <span id="labelEmail"></span>
                </div>
                <input type="email" id="emailAddress" class="input-field" placeholder="ornek@email.com">
            </div>
            <div id="deptQuestions"></div>
            <div class="question">
                <div class="question-title">
                    <span class="question-icon">üìù</span>
                    <span id="labelComments"></span>
                </div>
                <textarea class="comment-box" id="comments" placeholder="..."></textarea>
            </div>
            <div class="loading" id="loading"><div class="spinner"></div></div>
            <button class="submit-btn" id="submitBtn" onclick="submitSurvey()"></button>
        </div>
        <div class="success-message" id="successMessage">
            <div class="success-icon">‚úÖ</div>
            <h2 id="successTitle"></h2>
            <p id="successBody"></p>
            <p style="margin-top:14px; font-weight:600;" id="successFooter"></p>
        </div>
    </div>
</div>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
const supabase = createClient(
    'https://hxjpzgqrylmcwabkfnqc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4anB6Z3FyeWxtY3dhYmtmbnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1Nzk1ODksImV4cCI6MjA4NTE1NTU4OX0.YwQUuliCuxl4yc_Wqbt7UA79QYD1wxl-bmK4h1xG6Rc'
);

const LANGS = {
tr:{code:'tr',name:'TR',title:'üè® Misafir Memnuniyet Anketi',subtitle:'G√∂r√º≈üleriniz bizim i√ßin √ßok deƒüerli!',labelRoom:'Oda Numaranƒ±z',labelEmail:'E-posta Adresiniz',labelComments:'√ñnerileriniz ve Yorumlarƒ±nƒ±z',btnSubmit:'Anketi G√∂nder',successTitle:'Te≈üekk√ºr Ederim!',successBody:'G√∂r√º≈üleriniz bizim i√ßin √ßok deƒüerli. Daha iyi bir hizmet sunabilmek i√ßin geri bildirimlerinizi dikkate alacaƒüƒ±z.',successFooter:'Keyifli konaklama dileriz! üè®',errRoom:'L√ºtfen oda numaranƒ±zƒ± girin!',errEmail:'L√ºtfen e-posta adresinizi girin!',errEmailFmt:'L√ºtfen ge√ßerli bir e-posta adresi girin!',errRating:'L√ºtfen en az bir departmana puan verin!',errSend:'Anket g√∂nderilemedi. L√ºtfen tekrar deneyin.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'ƒ∞√ßecekler ve Servis'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Yiyecekler'},{key:'dept_cleaning',icon:'üßπ',name:'Temizlik'},{key:'dept_reception',icon:'üë•',name:'Resepsiyon'},{key:'dept_technical',icon:'üîß',name:'Teknik Servis'},{key:'dept_security',icon:'üõ°Ô∏è',name:'G√ºvenlik'},{key:'dept_return',icon:'üîÑ',name:'Bir daha gelir misiniz?'},{key:'dept_recommend',icon:'‚≠ê',name:'Bizi tavsiye eder misiniz?'}]},
en:{code:'en',name:'EN',title:'üè® Guest Satisfaction Survey',subtitle:'Your feedback is very important to us!',labelRoom:'Room Number',labelEmail:'Your Email Address',labelComments:'Suggestions & Comments',btnSubmit:'Submit Survey',successTitle:'Thank You!',successBody:'Your feedback is very valuable to us. We will take your comments into account to provide better service.',successFooter:'Enjoy your stay! üè®',errRoom:'Please enter your room number!',errEmail:'Please enter your email address!',errEmailFmt:'Please enter a valid email address!',errRating:'Please rate at least one department!',errSend:'Survey could not be sent. Please try again.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'Beverages & Service'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Food'},{key:'dept_cleaning',icon:'üßπ',name:'Cleanliness'},{key:'dept_reception',icon:'üë•',name:'Reception'},{key:'dept_technical',icon:'üîß',name:'Technical Service'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Security'},{key:'dept_return',icon:'üîÑ',name:'Will you come back?'},{key:'dept_recommend',icon:'‚≠ê',name:'Would you recommend us?'}]},
ru:{code:'ru',name:'RU',title:'üè® –û–ø—Ä–æ—Å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –≥–æ—Å—Ç–µ–π',subtitle:'–í–∞—à–∏ –æ—Ç–∑—ã–≤—ã –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã –¥–ª—è –Ω–∞—Å!',labelRoom:'–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã',labelEmail:'–í–∞—à –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã',labelComments:'–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏',btnSubmit:'–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–ø—Ä–æ—Å',successTitle:'–°–ø–∞—Å–∏–±–æ!',successBody:'–í–∞—à–∏ –æ—Ç–∑—ã–≤—ã –æ—á–µ–Ω—å —Ü–µ–Ω–Ω—ã –¥–ª—è –Ω–∞—Å. –ú—ã —É—á—Ç—ë–º –≤–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.',successFooter:'–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è! üè®',errRoom:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –≤–∞—à–µ–π –∫–æ–º–Ω–∞—Ç—ã!',errEmail:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã!',errEmailFmt:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å!',errRating:'–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ—Ç–¥–µ–ª!',errSend:'–û–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'–ù–∞–ø–∏—Ç–∫–∏ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'},{key:'dept_food',icon:'üçΩÔ∏è',name:'–ü–∏—Ç–∞–Ω–∏–µ'},{key:'dept_cleaning',icon:'üßπ',name:'–ß–∏—Å—Ç–æ—Ç–∞'},{key:'dept_reception',icon:'üë•',name:'–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'},{key:'dept_technical',icon:'üîß',name:'–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'},{key:'dept_security',icon:'üõ°Ô∏è',name:'–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å'},{key:'dept_return',icon:'üîÑ',name:'–í—ã –ø—Ä–∏–µ–¥–µ—Ç–µ —Å–Ω–æ–≤–∞?'},{key:'dept_recommend',icon:'‚≠ê',name:'–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ –ª–∏ –≤—ã –Ω–∞—Å?'}]},
de:{code:'de',name:'DE',title:'üè® G√§ste-Zufriedenheitsbefragung',subtitle:'Ihre R√ºckmeldung ist sehr wichtig f√ºr uns!',labelRoom:'Zimmernummer',labelEmail:'Ihre E-Mail-Adresse',labelComments:'Vorschl√§ge und Kommentare',btnSubmit:'Umfrage senden',successTitle:'Vielen Dank!',successBody:'Ihre R√ºckmeldung ist sehr wertvoll. Wir werden Ihre Kommentare ber√ºcksichtigen.',successFooter:'Genie√üen Sie Ihren Aufenthalt! üè®',errRoom:'Bitte geben Sie Ihre Zimmernummer ein!',errEmail:'Bitte geben Sie Ihre E-Mail-Adresse ein!',errEmailFmt:'Bitte geben Sie eine g√ºltige E-Mail ein!',errRating:'Bitte bewerten Sie mindestens eine Abteilung!',errSend:'Die Umfrage konnte nicht gesendet werden.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'Getr√§nke & Service'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Essen'},{key:'dept_cleaning',icon:'üßπ',name:'Sauberkeit'},{key:'dept_reception',icon:'üë•',name:'Empfang'},{key:'dept_technical',icon:'üîß',name:'Technischer Dienst'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Sicherheit'},{key:'dept_return',icon:'üîÑ',name:'Kommen Sie wiederholt?'},{key:'dept_recommend',icon:'‚≠ê',name:'Empfehlen Sie uns?'}]},
pl:{code:'pl',name:'PL',title:'üè® Ankieta satysfakcji go≈õci',subtitle:'Wasze opinie sƒÖ dla nas bardzo wa≈ºne!',labelRoom:'Numer pokoju',labelEmail:'Tw√≥j adres e-mail',labelComments:'Sugestie i komentarze',btnSubmit:'Wy≈õlij ankietƒô',successTitle:'Dziƒôkujemy!',successBody:'Wasze opinie sƒÖ bardzo cenne. Uwzglƒôdnimy wasze komentarze dla lepszego serviceu.',successFooter:'Mi≈Ço spƒôdziƒá czas! üè®',errRoom:'Proszƒô podaƒá numer pokoju!',errEmail:'Proszƒô podaƒá adres e-mail!',errEmailFmt:'Proszƒô podaƒá poprawny adres e-mail!',errRating:'Proszƒô oceniƒá przynajmniej jeden dzia≈Ç!',errSend:'Ankieta nie zosta≈Ça wys≈Çana. Spr√≥buj ponownie.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'Napoje i obs≈Çuga'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Jedzenie'},{key:'dept_cleaning',icon:'üßπ',name:'SprzƒÖtanie'},{key:'dept_reception',icon:'üë•',name:'Recepcja'},{key:'dept_technical',icon:'üîß',name:'Obs≈Çuga techniczna'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Bezpiecze≈Ñstwo'},{key:'dept_return',icon:'üîÑ',name:'Czy wr√≥cisz?'},{key:'dept_recommend',icon:'‚≠ê',name:'Czy nas polecisz?'}]},
cs:{code:'cs',name:'CZ',title:'üè® Pr≈Øzkum spokojnosti host√©',subtitle:'Va≈°e zpƒõtn√° vazba je pro n√°s hodnƒõ d≈Øle≈æit√°!',labelRoom:'ƒå√≠slo m√≠stnosti',labelEmail:'V√°≈° e-mailov√Ω adresa',labelComments:'N√°vrhy a koment√°≈ôe',btnSubmit:'Odeslat pr≈Øzkum',successTitle:'Dƒõkujeme!',successBody:'Va≈°e zpƒõtn√° vazba je pro n√°s hodnƒõ cenn√°. Zohledn√≠me va≈°e koment√°≈ôe.',successFooter:'P≈ô√≠jemn√Ω pobyt! üè®',errRoom:'Pros√≠m, zadejte ƒç√≠slo m√≠stnosti!',errEmail:'Pros√≠m, zadejte e-mailovou adresu!',errEmailFmt:'Pros√≠m, zadejte platnou e-mailovou adresu!',errRating:'Pros√≠m, ohodno≈•te alespo≈à jednu oddƒõlen√≠!',errSend:'Pr≈Øzkum nebyl odesl√°n. Zkuste znovu.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'N√°poje a obsluha'},{key:'dept_food',icon:'üçΩÔ∏è',name:'J√≠dlo'},{key:'dept_cleaning',icon:'üßπ',name:'√öklid'},{key:'dept_reception',icon:'üë•',name:'Recepce'},{key:'dept_technical',icon:'üîß',name:'Technick√° obsluha'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Bezpeƒçnost'},{key:'dept_return',icon:'üîÑ',name:'Vr√°t√≠te se?'},{key:'dept_recommend',icon:'‚≠ê',name:'Doporuƒç√≠te n√°s?'}]},
fr:{code:'fr',name:'FR',title:'üè® Enqu√™te de satisfaction des h√¥tes',subtitle:'Vos avis sont tr√®s importants pour nous !',labelRoom:'Num√©ro de chambre',labelEmail:'Votre adresse e-mail',labelComments:'Suggestions et commentaires',btnSubmit:'Envoyer l\'enqu√™te',successTitle:'Merci !',successBody:'Vos avis sont tr√®s pr√©cieux pour nous. Nous en tiendrons compte pour am√©liorer notre service.',successFooter:'Profitez de votre s√©jour ! üè®',errRoom:'Veuillez entrer votre num√©ro de chambre !',errEmail:'Veuillez entrer votre adresse e-mail !',errEmailFmt:'Veuillez entrer une adresse e-mail valide !',errRating:'Veuillez √©valuer au moins un d√©partement !',errSend:'L\'enqu√™te n\'a pas pu √™tre envoy√©e.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'Boissons & Service'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Nourriture'},{key:'dept_cleaning',icon:'üßπ',name:'Propret√©'},{key:'dept_reception',icon:'üë•',name:'R√©ception'},{key:'dept_technical',icon:'üîß',name:'Service technique'},{key:'dept_security',icon:'üõ°Ô∏è',name:'S√©curit√©'},{key:'dept_return',icon:'üîÑ',name:'Reviendrez-vous ?'},{key:'dept_recommend',icon:'‚≠ê',name:'Nous recommanderiez-vous ?'}]},
da:{code:'da',name:'DK',title:'üè® G√¶stetilfreds Unders√∏gelse',subtitle:'Jeres tilbagemeldinger er meget vigtige for os!',labelRoom:'Rumsnummer',labelEmail:'Din e-mailadresse',labelComments:'Forslag og kommentarer',btnSubmit:'Inds√¶nd unders√∏gelse',successTitle:'Tak!',successBody:'Jeres tilbagemeldinger er meget forskellige for os. Vi vil tage jeres kommentarier i betragtning.',successFooter:'Nyd dit ophold! üè®',errRoom:'Venlig udfyld dit rumsnummer!',errEmail:'Venlig udfyld din e-mailadresse!',errEmailFmt:'Venlig udfyld en gyldig e-mailadresse!',errRating:'Venlig vurderer mindst √©n afdeling!',errSend:'Unders√∏gelsen kunne ikke sendes.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'Drinks & Service'},{key:'dept_food',icon:'üçΩÔ∏è',name:'Mad'},{key:'dept_cleaning',icon:'üßπ',name:'Renlighed'},{key:'dept_reception',icon:'üë•',name:'Reception'},{key:'dept_technical',icon:'üîß',name:'Teknisk service'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Sikkerhed'},{key:'dept_return',icon:'üîÑ',name:'Vender I jer tilbage?'},{key:'dept_recommend',icon:'‚≠ê',name:'Anbefaler I jer os?'}]},
ro:{code:'ro',name:'RO',title:'üè® Sondaj de satisfac»õie a hoteluluilor',subtitle:'Opiniile dumneavoastrƒÉ sunt foart importante pentru noi!',labelRoom:'NumƒÉrul camerelor',labelEmail:'Adresa dumneavoastrƒÉ de e-mail',labelComments:'Sugestii »ôi comentarii',btnSubmit:'Trimite»õi sondajul',successTitle:'Mul»õumim!',successBody:'Opiniile dumneavoastrƒÉ sunt foart pre»õioase. Vom »õine cont de comentariile dumneavoastrƒÉ.',successFooter:'Bucura»õi-vƒÉ de »ôederea dumneavoastrƒÉ! üè®',errRoom:'VƒÉ rugƒÉm sƒÉ introduce»õi numƒÉrul camerelor!',errEmail:'VƒÉ rugƒÉm sƒÉ introduce»õi adresa de e-mail!',errEmailFmt:'VƒÉ rugƒÉm sƒÉ introduce»õi o adresƒÉ de e-mail validƒÉ!',errRating:'VƒÉ rugƒÉm sƒÉ evalua»õi cel pu»õin un departament!',errSend:'Sondajul nu a fost trimis. √éncerca»õi din nou.',depts:[{key:'dept_beverages_service',icon:'üçπ',name:'BƒÉuturi »ôi serviciu'},{key:'dept_food',icon:'üçΩÔ∏è',name:'M√¢ncare'},{key:'dept_cleaning',icon:'üßπ',name:'CurƒÉ»õenie'},{key:'dept_reception',icon:'üë•',name:'Recep»õie'},{key:'dept_technical',icon:'üîß',name:'Serviciu tehnic'},{key:'dept_security',icon:'üõ°Ô∏è',name:'Securitate'},{key:'dept_return',icon:'üîÑ',name:'Ve»õi reveni?'},{key:'dept_recommend',icon:'‚≠ê',name:'Ne ve»õi recomanda?'}]}
};

let currentLang = 'tr';
const ratings = {};

function detectLang() {
    const url = new URLSearchParams(window.location.search);
    if (url.get('lang') && LANGS[url.get('lang')]) return url.get('lang');
    const b = (navigator.language || 'tr').split('-')[0].toLowerCase();
    return LANGS[b] ? b : 'tr';
}

function renderLangBar() {
    document.getElementById('langBar').innerHTML = Object.keys(LANGS).map(c =>
        `<button class="lang-btn ${c===currentLang?'active':''}" onclick="setLang('${c}')">${LANGS[c].name}</button>`
    ).join('');
}

function setLang(code) {
    currentLang = code;
    const L = LANGS[code];
    document.documentElement.lang = code;
    document.getElementById('titleText').textContent     = L.title;
    document.getElementById('subtitleText').textContent  = L.subtitle;
    document.getElementById('labelRoom').textContent     = L.labelRoom;
    document.getElementById('labelEmail').textContent    = L.labelEmail;
    document.getElementById('labelComments').textContent = L.labelComments;
    document.getElementById('submitBtn').textContent     = L.btnSubmit;
    document.getElementById('successTitle').textContent  = L.successTitle;
    document.getElementById('successBody').textContent   = L.successBody;
    document.getElementById('successFooter').textContent = L.successFooter;
    renderLangBar();
    renderDeptQuestions();
}
window.setLang = setLang;

function renderDeptQuestions() {
    const L = LANGS[currentLang];
    const c = document.getElementById('deptQuestions');
    c.innerHTML = L.depts.map(d => {
        ratings[d.key] = ratings[d.key] || 0;
        const v = ratings[d.key];
        return `<div class="question">
            <div class="question-title"><span class="question-icon">${d.icon}</span><span>${d.name}</span></div>
            <div class="star-rating" data-dept="${d.key}">
                ${[1,2,3,4,5].map(i=>`<span class="star ${i<=v?'active':''}" data-value="${i}">${i<=v?'‚≠ê':'‚òÜ'}</span>`).join('')}
            </div></div>`;
    }).join('');

    c.querySelectorAll('.star-rating').forEach(g => {
        const dept = g.dataset.dept;
        g.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', () => {
                const val = parseInt(star.dataset.value);
                ratings[dept] = val;
                g.querySelectorAll('.star').forEach((s,i) => {
                    s.classList.toggle('active', i < val);
                    s.textContent = i < val ? '‚≠ê' : '‚òÜ';
                });
            });
        });
    });
}

window.submitSurvey = async function() {
    const L = LANGS[currentLang];
    const room  = document.getElementById('roomNumber').value.trim();
    const email = document.getElementById('emailAddress').value.trim();

    if (!room)  return showError(L.errRoom);
    if (!email) return showError(L.errEmail);
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return showError(L.errEmailFmt);
    if (!Object.values(ratings).some(r => r > 0))   return showError(L.errRating);

    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    document.getElementById('loading').classList.add('show');
    hideError();

    try {
        const payload = { room_number: room, email, comments: document.getElementById('comments').value || null };
        LANGS.tr.depts.forEach(d => { payload[d.key] = ratings[d.key] || null; });

        const { error } = await supabase.from('surveys').insert([payload]);
        if (error) throw error;

        document.getElementById('surveyForm').style.display = 'none';
        document.getElementById('successMessage').classList.add('show');
    } catch(e) {
        console.error(e);
        showError(L.errSend);
        btn.disabled = false;
    } finally {
        document.getElementById('loading').classList.remove('show');
    }
}

function showError(msg) {
    const el = document.getElementById('errorMessage');
    el.textContent = '‚ö†Ô∏è ' + msg;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 5000);
}
function hideError() { document.getElementById('errorMessage').classList.remove('show'); }

// INIT
(function() {
    const url = new URLSearchParams(window.location.search);
    const room = decodeURIComponent(url.get('oda') || '');
    if (room) document.getElementById('roomNumber').value = room;
    currentLang = detectLang();
    setLang(currentLang);
})();
</script>
</body>
</html>
